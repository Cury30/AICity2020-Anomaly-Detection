code for fusion and backtracking optimization
